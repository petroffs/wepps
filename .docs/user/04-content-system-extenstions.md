# Системные расширения

Подробное руководство по работе с системными расширениями административной панели.

## Что такое системные расширения?

**Системные расширения (ConfigExtensions)** - это специальные модули административной панели для управления платформой, которые отличаются от обычных расширений для контента.

**Доступ:** **Расширения** в главном меню админки.

**Отличия от обычных расширений:**
- Хранятся в таблице `s_ConfigExtensions` (а не `s_Extensions`)
- Расположены в папке `WeppsAdmin/ConfigExtensions/`
- Имеют собственную навигацию и подразделы
- Предназначены для технических задач и администрирования

## Встроенные расширения

### Обработка данных (Processing)

**Назначение:** Массовая обработка товаров и контента, выполнение фоновых задач

**Возможности:**
- Пакетные операции над большими объемами данных
- Обработка товаров каталога
- Выполнение фоновых задач по расписанию
- Массовое обновление полей

**Использование:**
1. Откройте **Расширения → Обработка данных**
2. Выберите нужный тип обработки
3. Настройте параметры
4. Запустите задачу

### Резервирование (Backup)

**Назначение:** Создание резервных копий базы данных и файлов проекта

**Возможности:**
- Создание бэкапов базы данных в формате SQL
- Архивирование файлов проекта
- Восстановление из резервных копий
- История созданных бэкапов

**Рекомендации:**
- Создавайте бэкапы перед обновлением платформы
- Регулярно сохраняйте копии БД (раз в неделю минимум)
- Храните бэкапы в безопасном месте вне сервера
- Проверяйте возможность восстановления

**Использование:**
1. Откройте **Расширения → Резервирование**
2. Выберите тип бэкапа:
   - **База данных** - экспорт всех таблиц в SQL
   - **Файлы** - архив загруженных файлов
3. Нажмите **Создать резервную копию**
4. Скачайте созданный архив

### Заказы (Orders)

**Назначение:** Просмотр и управление заказами с сайта

**Возможности:**
- Просмотр списка всех заказов
- Фильтрация по статусам и датам
- Детальная информация о каждом заказе
- Изменение статуса заказа
- Печатные формы

**Структура данных:**
- Основная информация в таблице `Orders`
- Связь с пользователями через `s_Users`
- Статусы заказов в `OrdersStatuses`

**Использование:**
1. Откройте **Расширения → Заказы**
2. Используйте фильтры для поиска нужных заказов
3. Кликните на заказ для просмотра деталей
4. Измените статус при необходимости

### Загрузки в систему (Uploads)

**Назначение:** Импорт и экспорт данных через Excel файлы

**Возможности:**
- Импорт данных из Excel в любую таблицу
- Экспорт данных из списков в XLSX
- Шаблоны для импорта полей (s_ConfigFields)
- Универсальный импорт через настраиваемые источники

#### Экспорт данных

**Где находится:** Кнопка **Экспорт** в интерфейсе любого списка

**Что экспортируется:**
- Максимум 5000 записей за один экспорт
- Все поля таблицы
- Первая строка - названия полей
- Вторая строка - технические имена полей

**Пример:**
```
ID | Название       | Артикул  | Цена
Id | Name           | Article  | Price
1  | Смартфон       | ART-001  | 15000
2  | Ноутбук        | ART-002  | 45000
```

**Ограничения:**
- Связанные данные (select) экспортируются как ID
- Файлы не экспортируются (только URL)
- Фильтры не учитываются

#### Импорт данных

**Доступ:** **Расширения → Загрузки в систему → Загрузки из Excel**

**Встроенные шаблоны:**
- `UploadsExcelFields` - импорт полей для конфигурации таблиц
- `UploadsExcelListData` - универсальный импорт данных
- `UploadsExcelTranslate` - импорт переводов (в разработке)

**Процесс импорта:**

1. **Подготовьте Excel файл:**
   - Строка 1: Заголовки (любые, для удобства)
   - Строка 2: Технические имена полей из БД
   - Строка 3+: Данные для импорта

2. **Создайте источник в s_UploadsSource:**
   - Name: Название источника ("Импорт товаров")
   - Alias: Шаблон (`UploadsExcelListData`)
   - Descr: Имя таблицы (`Products`)

3. **Загрузите файл:**
   - Откройте **Загрузки из Excel**
   - Выберите источник из списка **Цель**
   - Нажмите **Загрузить** и выберите файл
   - Нажмите **Далее**

4. **Система обработает:**
   - Прочитает Excel файл
   - Сопоставит поля со второй строки
   - Выполнит `INSERT IGNORE` для новых записей
   - Выполнит `UPDATE` для существующих (по ID)

**Особенности:**
- Записи с существующим ID обновляются
- Новые ID создаются автоматически
- Пустые строки игнорируются
- При ошибке в именах полей - импорт прерывается

## Создание собственных расширений

Системные расширения можно создавать автоматически из админки:

1. Перейдите в **Списки → s_ConfigExtensions**
2. Нажмите **Добавить**
3. Заполните поля:
   - **Name** - название расширения
   - **Alias** - техническое имя (латиница)
   - **Priority** - порядок в меню
   - **ENav** - подразделы навигации (JSON)
4. Сохраните

Система автоматически создаст папку в `WeppsAdmin/ConfigExtensions/{Alias}/` с базовыми файлами:
- `{Alias}.php` - основной класс
- `{Alias}.tpl` - шаблон
- `Request.php` - обработчик AJAX запросов

**Подробнее см. [Разработка расширений](../technical/04-extensions-development.md)**

## Полезные советы

### Безопасность

- Доступ к системным расширениям только у администраторов
- Проверяйте права перед выполнением критичных операций
- Логируйте действия пользователей

### Производительность

- Фоновые задачи выполняйте через Processing
- Большие импорты разбивайте на части
- Используйте индексы БД для ускорения обработки

### Мониторинг

- Отслеживайте размер бэкапов
- Проверяйте логи ошибок после импорта
- Тестируйте восстановление из резервных копий

## Дополнительные материалы

- [Работа со списками](03-content-lists.md)
- [Архитектура платформы](../technical/02-architecture.md)
- [Разработка расширений](../technical/04-extensions-development.md)
